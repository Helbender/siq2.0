You are working on a production-grade fullstack application with:

Frontend:
- React + Vite
- React Router v7 (Data Router)
- Chakra UI v3
- TanStack React Query

Backend:
- Python + Flask
- SQLAlchemy
- JWT authentication
- Role-Based Access Control (RBAC)

You MUST follow the architectural rules below STRICTLY.

=====================================================
GLOBAL ARCHITECTURAL PRINCIPLES
=====================================================

1. Feature-first architecture
- Business logic lives in FEATURES
- Infrastructure and orchestration live OUTSIDE features
- No "shared god folders"

2. Clear responsibility boundaries
Each folder has ONE job.
Never mix responsibilities.

3. Frontend and backend MUST mirror concepts
- Feature names MUST match
- Permissions MUST align
- Routes and policies MUST align

=====================================================
FRONTEND ARCHITECTURE
=====================================================

-----------------------------------------------------
SHELL (APP CHROME)
-----------------------------------------------------

Location:
src/shell/

Purpose:
- Application structure only
- Visual frame of the app

Allowed:
- Layout components
- Header / Footer / Navbar
- <Outlet /> rendering

Forbidden:
❌ Business logic
❌ API calls
❌ React Query
❌ Permissions logic
❌ Feature imports

Structure:
src/shell/
  layout/
    AppLayout.tsx
    AuthenticatedLayout.tsx
  components/
    Header.tsx
    Footer.tsx
    NavbarLeft.tsx

Rules:
- Layouts MAY render Outlet
- Layouts MUST NOT fetch data
- Layouts MUST NOT check roles or permissions

-----------------------------------------------------
COMMON (REUSABLE, APP-AGNOSTIC)
-----------------------------------------------------

Location:
src/common/

Purpose:
- Reusable UI and hooks
- No domain knowledge

Allowed:
- Generic components
- Generic hooks
- Styling helpers

Forbidden:
❌ Feature-specific logic
❌ Routing
❌ API endpoints

Structure:
src/common/
  components/
    StandardText.tsx
    StyledText.tsx
  hooks/
    useDialogForm.ts
    useConfirm.ts

-----------------------------------------------------
FEATURES (BUSINESS DOMAINS)
-----------------------------------------------------

Location:
src/features/<feature-name>/

Purpose:
- Own ALL logic related to a business domain

Structure:
src/features/<feature>/
  components/
  pages/
  hooks/
  queries/
  mutations/
  routes.ts
  permissions.ts

Rules:
- Features MUST export route objects (not routers)
- Features MUST export permission definitions
- Features MUST NOT import layouts
- Features MUST NOT import router

Example routes export:
export const flightsRoutes = [
  {
    path: "/flights",
    element: <FlightsPage />,
    meta: { permission: "flights.read" }
  }
];

-----------------------------------------------------
ROUTING (FIRST-CLASS SYSTEM)
-----------------------------------------------------

Location:
src/routes/

Purpose:
- Application orchestration
- Layout assignment
- Access control enforcement

Structure:
src/routes/
  router.tsx
  public.routes.ts
  protected.routes.ts

Rules:
- createBrowserRouter MUST exist ONLY in router.tsx
- Layouts are applied ONLY here
- Route guards are applied ONLY here

-----------------------------------------------------
RBAC (FRONTEND)
-----------------------------------------------------

Rules:
- Permissions are STRINGS (not booleans)
- Roles are GROUPS of permissions
- UI checks permissions, not roles

Example permission:
"flights.read"
"flights.write"
"users.admin"

Feature permissions:
src/features/flights/permissions.ts

export const FLIGHTS_PERMISSIONS = {
  READ: "flights.read",
  WRITE: "flights.write",
};

Routes use permissions via meta:
meta: { permission: FLIGHTS_PERMISSIONS.READ }

Route guards check permissions globally.

-----------------------------------------------------
TANSTACK QUERY RULES
-----------------------------------------------------

Rules:
- ALL data fetching uses React Query
- Queries live in features/<feature>/queries
- Mutations live in features/<feature>/mutations
- Pages MAY call useQuery
- Components MUST NOT call useQuery unless explicitly container components

Forbidden:
❌ API calls in components
❌ API calls in layouts
❌ API calls in shell

-----------------------------------------------------
ABSOLUTE IMPORT RULES
-----------------------------------------------------

- Use alias imports: "@/features/..."
- Features MAY import from:
  - common
  - services
  - lib
- Features MUST NOT import from:
  - shell
  - routes

- shell MUST NOT import from features

=====================================================
BACKEND ARCHITECTURE (FLASK)
=====================================================

-----------------------------------------------------
CORE
-----------------------------------------------------

Location:
api/app/core/

Purpose:
- App setup
- Security
- JWT
- Config

-----------------------------------------------------
FEATURES (BACKEND)
-----------------------------------------------------

Location:
api/app/features/<feature>/

Structure:
api/app/features/<feature>/
  routes.py
  service.py
  repository.py
  models.py
  schemas.py
  policies.py

Rules:
- routes.py → HTTP only
- service.py → business logic
- repository.py → database access ONLY
- policies.py → permission checks ONLY

Forbidden:
❌ DB access in routes
❌ Permission logic in routes
❌ HTTP logic in services

-----------------------------------------------------
RBAC (BACKEND)
-----------------------------------------------------

Rules:
- Permissions are STRING constants
- Policies enforce permissions
- Routes call policies

Example:
require_permission("flights.write")

Frontend permissions MUST match backend permissions exactly.

-----------------------------------------------------
WHAT NOT TO DO (STRICT)
-----------------------------------------------------

❌ Do NOT create "shared" dumping grounds
❌ Do NOT fetch data in layouts
❌ Do NOT check roles in components
❌ Do NOT hardcode permissions in UI
❌ Do NOT place routers inside features
❌ Do NOT place business logic in UI components

=====================================================
DEFAULT DECISION RULE
=====================================================

When unsure:
- Business logic → feature
- App structure → shell
- Reusable logic → common
- Orchestration → routes
- Data access → repository
- Permission checks → policies

Follow these rules without exception.
