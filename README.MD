# SIQ - Sistema Integrado de Qualifica√ß√µes

Sistema Integrado de Qualifica√ß√µes para gest√£o de voos, tripulantes e qualifica√ß√µes da Esquadra 502.

O SIQ √© uma aplica√ß√£o full-stack desenvolvida para facilitar a gest√£o de:
- **Voo**s: Registro e edi√ß√£o de voos (Modelo 1M)
- **Tripulantes**: Gest√£o de pilotos e elementos de tripula√ß√£o
- **Qualifica√ß√µes**: Rastreamento de qualifica√ß√µes e valida√ß√µes de tripulantes
- **Dashboard**: Visualiza√ß√£o estat√≠stica e relat√≥rios

---

## üèóÔ∏è Arquitetura

- **Frontend**: React 18 com Vite, Chakra UI, React Router
- **Backend**: Python Flask com SQLAlchemy ORM
- **Database**: PostgreSQL (produ√ß√£o) ou SQLite (desenvolvimento)
- **Autentica√ß√£o**: JWT com Flask-JWT-Extended
- **Build**: Docker & Docker Compose

---

## üöÄ Instala√ß√£o e Configura√ß√£o

### Pr√©-requisitos

- Python 3.12+
- Node.js 18+
- PostgreSQL (opcional, para produ√ß√£o)
- Docker & Docker Compose (recomendado)

### Configura√ß√£o da API

1. Navegar para o diret√≥rio da API:
```bash
cd api
```

2. Instalar depend√™ncias Python:
```bash
# Com pip
pip install -r requirements.txt

# Ou com uv (recomendado)
uv sync
```

3. Criar ficheiro `.env` na pasta `api/`:
```env
# Database Configuration
user=your_db_user
password=your_db_password
host=your_db_host
port=5432
dbname=your_db_name

# JWT Configuration
JWT_KEY=your_secret_jwt_key_here_make_it_long_and_random

# CORS Configuration
APPLY_CORS=true

# Development Mode (set to 0 for production)
DEV=1

# Google Drive Integration (opcional)
ID_PASTA_VOO=your_google_drive_folder_id_for_flights
ID_PASTA_PDF=your_google_drive_folder_id_for_pdfs

# SMTP Configuration (para envio de emails)
SMTP_SERVER=mail.esq502.pt
SMTP_PORT=465
SMTP_USER=noreply@esq502.pt
SMTP_PASSWORD=your_smtp_password
```

4. Configurar base de dados:
```bash
# Com Alembic (migrations)
cd api
alembic upgrade head

# Ou criar tabelas diretamente
python -c "from app import app, setup_database; setup_database()"
```

5. Executar API:
```bash
# Desenvolvimento
python wsgi.py

# Produ√ß√£o com Gunicorn
gunicorn -w 4 -b 0.0.0.0:5051 wsgi:app
```

### Configura√ß√£o do Frontend

1. Navegar para o diret√≥rio do frontend:
```bash
cd frontend
```

2. Instalar depend√™ncias:
```bash
npm install
```

3. Criar ficheiro `.env` na pasta `frontend/`:
```env
# API URL
VITE_API_URL=http://localhost:5051/api
```

4. Executar em modo desenvolvimento:
```bash
npm run dev
```

5. Build para produ√ß√£o:
```bash
npm run build
```

---

## üê≥ Execu√ß√£o com Docker

A forma mais f√°cil de executar toda a aplica√ß√£o √© usando Docker Compose:

1. Clonar o reposit√≥rio:
```bash
git clone <repository-url>
cd DinamicQualification
```

2. Configurar vari√°veis de ambiente:
   - Editar `api/.env` com as configura√ß√µes da API
   - Editar `frontend/.env` com a URL da API

3. Executar com Docker Compose:
```bash
docker-compose up -d
```

Os servi√ßos estar√£o dispon√≠veis em:
- **Frontend**: http://localhost:5173
- **API**: http://localhost:5051
- **Database**: localhost:3306 (MySQL para desenvolvimento)

### Docker Compose Override

Para configura√ß√£o de produ√ß√£o, pode criar um `docker-compose.prod.yml`:

```yaml
version: '3.8'

services:
  api:
    build:
      dockerfile: Dockerfile  # Produ√ß√£o
    environment:
      - APPLY_CORS=0
      # ... outras vari√°veis

  frontend:
    build:
      dockerfile: Dockerfile  # Produ√ß√£o
    ports:
      - "80:80"  # Porta HTTP padr√£o
```

---

## üìã Vari√°veis de Ambiente

### API (.env)

| Vari√°vel | Descri√ß√£o | Obrigat√≥ria | Default |
|----------|-----------|-------------|---------|
| `user` | Usu√°rio da base de dados | ‚úÖ | - |
| `password` | Password da base de dados | ‚úÖ | - |
| `host` | Host da base de dados | ‚úÖ | localhost |
| `port` | Porta da base de dados | ‚úÖ | 5432 |
| `dbname` | Nome da base de dados | ‚úÖ | - |
| `JWT_KEY` | Chave secreta para JWT | ‚úÖ | - |
| `APPLY_CORS` | Ativar CORS (true/false) | ‚ùå | true |
| `DEV` | Modo desenvolvimento (0/1) | ‚ùå | 0 |
| `ID_PASTA_VOO` | ID pasta Google Drive voos | ‚ùå | - |
| `ID_PASTA_PDF` | ID pasta Google Drive PDFs | ‚ùå | - |
| `SMTP_SERVER` | Servidor SMTP | ‚ùå | mail.esq502.pt |
| `SMTP_PORT` | Porta SMTP | ‚ùå | 465 |
| `SMTP_USER` | Usu√°rio SMTP | ‚ùå | noreply@esq502.pt |
| `SMTP_PASSWORD` | Password SMTP | ‚ùå | - |

### Frontend (.env)

| Vari√°vel | Descri√ß√£o | Obrigat√≥ria | Default |
|----------|-----------|-------------|---------|
| `VITE_API_URL` | URL da API backend | ‚úÖ | http://localhost:5051/api |

---

## üóÑÔ∏è Estrutura da Base de Dados

### Tabelas Principais

- **flights_table**: Informa√ß√µes dos voos (Modelo 1M)
- **flight_pilots**: Rela√ß√£o voos-tripulantes com estat√≠sticas
- **tripulantes**: Dados dos pilotos e elementos de tripula√ß√£o
- **qualificacoes**: Cat√°logo de qualifica√ß√µes
- **tripulante_qualificacao**: Valida√ß√µes de qualifica√ß√µes por tripulante

---

## üîê Autentica√ß√£o

A aplica√ß√£o usa JWT (JSON Web Tokens) para autentica√ß√£o:

- Tokens expiram em **1 hora**
- Refresh autom√°tico de tokens expirados
- Redirecionamento para login em caso de 401

### Criar utilizador admin

```python
python -c "
from app import app
from models.tripulantes import Tripulante
from api import engine
from sqlalchemy.orm import Session

with Session(engine) as session:
    admin = Tripulante(
        nip=123456789,
        name='Admin',
        rank='Cap',
        tipo='ADMIN'
    )
    session.add(admin)
    session.commit()
"
```

---

## üìö Scripts √öteis

### Importar voos
```bash
cd api
python import_flights.py
```

### Migra√ß√µes da base de dados
```bash
cd api
# Criar nova migra√ß√£o
alembic revision --autogenerate -m "descricao"

# Aplicar migra√ß√µes
alembic upgrade head

# Reverter √∫ltima migra√ß√£o
alembic downgrade -1
```

---

## üõ†Ô∏è Desenvolvimento

### Tech Stack

**Backend:**
- Flask 3.1+
- SQLAlchemy 2.0+
- Alembic (migrations)
- Flask-JWT-Extended
- PostgreSQL/MySQL driver
- Google API Client (Drive integration)
- ReportLab (PDF generation)

**Frontend:**
- React 18
- Vite 6
- Chakra UI
- React Router
- Axios
- React Hook Form

### Linting e Formata√ß√£o

**Backend:**
```bash
# MyPy (type checking)
mypy api/

# Ruff (linting & formatting)
ruff check api/
ruff format api/
```

**Frontend:**
```bash
# ESLint
npm run lint

# Prettier (automatic on save se configurado)
npx prettier --write .
```

---

## ü§ù Contribuidores

- **Cap. PilAv Tiago Branco**
- **Maj. PilAv Pedro Andrade**

*Elefantes - Sobre as asas √≠nclitas da Fama*

---

## üìù Notas

- Para produ√ß√£o, configurar NGINX como reverse proxy
- Backups regulares da base de dados recomendados
- Logs de erro dispon√≠veis no console/terminal
- Google Drive integration requer configura√ß√£o OAuth

---

## üìÑ Licen√ßa

Este √© um projeto interno da Esquadra 502.